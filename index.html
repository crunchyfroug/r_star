<!DOCTYPE html>
<html lang="en" dir="ltr">
<style>

</style>
<head>
    <meta charset="UTF-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script defer src="index.js" charset="utf-8"></script>
</head>
<body>
    <div id="dates">
        <br>
        <input id="begin" type="date">
        <input id = end type="date">
    </div><br>
    <div id="buttons">
        
        <button type="button" name="submit" onclick="searchData()">Search</button>
        <button type="button" name="clear" onclick="clearDates()">Clear dates</button>
    </div>

    </div>
    <div id="container">
    </div>

</body>
<script>
    function clearDates(target) {
        begin.value="";
        end.value="";
    }
    function searchData () {
    document.getElementById("container").innerHTML = "";
    var startDate = document.getElementById("begin").value;
    var endDate = document.getElementById("end").value;
    var unixStart = new Date(startDate).getTime() / 1000.0;
    var unixEnd = new Date(endDate).getTime() / 1000.0;
    api_url = `https://api.coingecko.com/api/v3/coins/bitcoin/market_chart/range?vs_currency=eur&from=${unixStart}&to=${unixEnd}`;
    console.log(unixStart, unixEnd)

    var options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
   
    
     

    $.getJSON(api_url, function(data) {
        var i = 0;
        const container = data.prices.map(([aika, hinta]) => {
            const myDate = new Date(aika);
            if (myDate.getTimezoneOffset() > 0 ) {
                myDate.setHours (myDate.getHours()- myDate.getTimezoneOffset()/60);
            } else {
                myDate.setHours (myDate.getHours() + myDate.getTimezoneOffset()/60);
            }
            document.getElementById("container").innerHTML += "<br>"+myDate.toDateString();
            //console.log(aika, hinta);
            return [aika,hinta];
        });

        for (var  i = 1; i < container.length;) {
            try {
                var currentDate = new Date(container[i][0]).toDateString();
                var previousDate = new Date(container[i-1][0]).toDateString();  
                if (currentDate == previousDate) {
                    container.splice(i,1);
    
                }
                else {
                    break;
                }
            }catch {
                console.log("Couldn't perform code")
            }
            finally {
                continue;
            }

        }
        console.log(container);

    });
}
</script>
</html>